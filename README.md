# Maya 权重工具集 (Maya Weighting Toolset)

这是一个用于 Autodesk Maya 的高级权重工具集，旨在为技术美术师（TA）和绑定师（Rigger）提供高效、精准的蒙皮权重解决方案。该项目结合了 Python 脚本的灵活性和 C++ 核心库的性能优势。

## ✨ 功能特性 (Features)

- **多种权重笔刷模式**:
  - **贝塞尔曲线 (Bezier)**: 通过可交互的贝塞尔曲线来直观地控制权重分布。
  - **IK/FK 模式**: 针对 IK 和 FK 链的快速权重工具。
  - **脊柱、背带、眉毛**: 预设的专用模式，用于处理特定身体部位的权重。
  - **点、线、链模式**: 基于点、线段或骨骼链进行权重分配。
- **权重雕刻 (Sculpt Weight)**: 提供类似雕刻的工作流，在复制的网格上进行形态调整，权重会自动映射回原始模型。
- **核心权重工具 (Core Weight Tools)**:
  - **权重拷贝**: 在不同模型或拓扑之间智能拷贝权重。
  - **权重缓存/加载**: 缓存和加载单个或多个骨骼的权重。
  - **限制最大影响数**: 优化蒙皮，确保每个顶点只受指定数量的骨骼影响。
  - **锁定骨骼平滑**: 在平滑权重时保持锁定骨骼的影响力不变。
- **动态 API 加载**: 自动检测当前 Maya 版本，并加载对应的 C++ 编译插件（`.pyd`），如果找不到，则使用纯 Python 的默认实现。
- **可交互 UI**: 提供一个集成的图形用户界面，包含所有主要功能，并支持实时权重预览。

## 📂 目录结构 (Directory Structure)

```
.
├── cores/                # C++ 核心库和编译后的 Python 模块 (.pyd)
│   ├── maya2016/         # 针对 Maya 2016 编译的模块
│   ├── ...               # 其他 Maya 版本
│   └── mayadefault/      # 纯 Python 的备用实现
├── data/                 # 存储用户配置，如工具参数
│   └── kwargs/
├── icons/                # UI 界面所需的图标
├── __init__.py           # 包初始化文件
├── api_lib.py            # 动态加载 C++/Python API 的核心逻辑
├── bezier_tool.py        # 所有基于贝塞尔曲线的权重算法
├── explorer.py           # 用于打开外部链接（文档、教程）
├── sculpt_weight.py      # 权重雕刻功能实现
├── ui.py                 # 基于 PySide/PySide2 的图形用户界面
└── weight_tool.py        # 核心权重工具���拷贝、平滑、限制等）
```

## 🚀 核心模块解析 (Core Modules)

- **`ui.py`**:
  构建了工具的主窗口。它集成了所有功能，并提供了一个基于贝塞尔曲线的交互式权重编辑器。

- **`api_lib.py`**:
  项目的“大脑”之一。它负责检测当前运行的 Maya 版本，并从 `cores` 目录中加载相应版本的 `.pyd` 文件。这确保了在支持的环境中可以获得 C++ 带来的高性能，同时在没有预编译模块时也能优雅地降级到 `mayadefault` 中的纯 Python 实现。

- **`bezier_tool.py`**:
  实现了多种基于贝塞尔曲线的权重分配算法。它定义了如 `ik_init`, `soft_init`, `spine_init` 等多种模式，并将计算任务分派给 `bezier_api`（由 `api_lib.py` 加载）。

- **`sculpt_weight.py`**:
  提供了一个创新的权重雕刻流程。它会创建一个模型的副本供用户雕刻，并通过 `scriptJob` 实时将形变转换回原始模型上的权重变化。

- **`weight_tool.py`**:
  包含了一系列实用的权重工具函数，例如 `copy_weights`, `limit_max_influence`, `lock_influence_smooth` 等。这些函数同样通过 `weight_tool_api` 调用底层实现。

- **`cores/`**:
  存放着项目的性能核心。`.cpp` 文件是 C++ 源码，它们��编译成针对不同 Maya 版本的 `.pyd` 文件，以 Python 模块的形式供上层脚本调用，极大地加速了权重计算的密集型任务。
